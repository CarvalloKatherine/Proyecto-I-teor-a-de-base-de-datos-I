CREATE TABLE Usuario (
    id_usuario              VARCHAR(30)     NOT NULL,
    clave                   VARCHAR(30)     NOT NULL,
    primer_nombre           VARCHAR(300),
    segundo_nombre          VARCHAR(300),
    primer_apellido         VARCHAR(300),
    segundo_apellido        VARCHAR(300),
    correo_electronico      VARCHAR(300),
    fecha_registro          DATE            DEFAULT CURRENT DATE,
    salario_mensual_base    DOUBLE,
    estado                  BIT             DEFAULT 1,
    creado_por              VARCHAR(300),
    creado_en               TIMESTAMP       DEFAULT CURRENT TIMESTAMP,
    modificado_por          VARCHAR(300),
    modificado_en           TIMESTAMP,
    PRIMARY KEY (id_usuario)
);


CREATE TABLE Presupuesto (
    id_presupuesto          VARCHAR(30)     NOT NULL,
    id_usuario              VARCHAR(30)     NOT NULL,
    usuario                 VARCHAR(300),
    nombre_descriptivo      VARCHAR(300),
    anio_inicio             INTEGER,
    mes_inicio              INTEGER,
    anio_fin                INTEGER,
    mes_fin                 INTEGER,
    total_ingresos          DOUBLE          DEFAULT 0,
    total_gastos            DOUBLE          DEFAULT 0,
    total_ahorro            DOUBLE          DEFAULT 0,
    fecha_hora_creacion     TIMESTAMP       DEFAULT CURRENT TIMESTAMP,
    estado_presupuesto      VARCHAR(300),
    creado_por              VARCHAR(300),
    creado_en               TIMESTAMP       DEFAULT CURRENT TIMESTAMP,
    modificado_por          VARCHAR(300),
    modificado_en           TIMESTAMP,
    PRIMARY KEY (id_presupuesto),
    FOREIGN KEY (id_usuario) REFERENCES Usuario (id_usuario)
);


CREATE TABLE Categoria (
    id_categoria            VARCHAR(30)     NOT NULL,
    nombre_categoria        VARCHAR(300),
    descripcion_detallada   VARCHAR(300),
    tipo_categoria          VARCHAR(30),
    nombre_icono            VARCHAR(30),
    color_hex               VARCHAR(30),
    orden_presentacion      VARCHAR(30),
    creado_por              VARCHAR(300),
    creado_en               TIMESTAMP       DEFAULT CURRENT TIMESTAMP,
    modificado_por          VARCHAR(300),
    modificado_en           TIMESTAMP,
    PRIMARY KEY (id_categoria)
);


CREATE TABLE SubCategoria (
    id_subcategoria             VARCHAR(30)     NOT NULL,
    id_categoria                VARCHAR(30)     NOT NULL,
    categoria_padre             VARCHAR(30),
    nombre_subcategoria         VARCHAR(300),
    descripcion_detallada_sub   VARCHAR(300),
    estado_sub                  BIT             DEFAULT 1,
    por_defecto                 BIT             DEFAULT 0,
    creado_por                  VARCHAR(300),
    creado_en                   TIMESTAMP       DEFAULT CURRENT TIMESTAMP,
    modificado_por              VARCHAR(300),
    modificado_en               TIMESTAMP,
    PRIMARY KEY (id_subcategoria),
    FOREIGN KEY (id_categoria) REFERENCES Categoria (id_categoria)
);


CREATE TABLE presupuesto_detalle (
    id_presupuesto_detalle  VARCHAR(30)     NOT NULL,
    id_presupuesto          VARCHAR(30)     NOT NULL,
    id_subcategoria         VARCHAR(30)     NOT NULL,
    presupuesto_padre       VARCHAR(30),
    subcategoria            VARCHAR(30),
    monto_mensual_asignado  DOUBLE,
    observaciones           VARCHAR(100),
    creado_por              VARCHAR(300),
    creado_en               TIMESTAMP       DEFAULT CURRENT TIMESTAMP,
    modificado_por          VARCHAR(300),
    modificado_en           TIMESTAMP,
    PRIMARY KEY (id_presupuesto_detalle),
    FOREIGN KEY (id_presupuesto)  REFERENCES Presupuesto (id_presupuesto),
    FOREIGN KEY (id_subcategoria) REFERENCES SubCategoria (id_subcategoria)
);


CREATE TABLE obligacion_fija (
    id_obligacion           VARCHAR(30)     NOT NULL,
    id_subcategoria         VARCHAR(30),
    usuario                 VARCHAR(30),
    subcategoria            VARCHAR(30),
    nombre_obligacion       VARCHAR(300),
    descripcion             VARCHAR(100),
    monto_fijo_mensual      DOUBLE,
    dia                     INTEGER,
    vigente                 BIT             DEFAULT 1,
    fecha_inicio            DATE,
    fecha_fin               DATE,
    creado_por              VARCHAR(300),
    creado_en               TIMESTAMP       DEFAULT CURRENT TIMESTAMP,
    modificado_por          VARCHAR(300),
    modificado_en           TIMESTAMP,
    PRIMARY KEY (id_obligacion),
    FOREIGN KEY (id_subcategoria) REFERENCES presupuesto_detalle (id_subcategoria)
);


CREATE TABLE transaccion (
    id_transaccion          VARCHAR(30)     NOT NULL,
    id_presupuesto_detalle  VARCHAR(30)     NOT NULL,
    usuario                 VARCHAR(30),
    presupuesto             VARCHAR(30),
    anio                    INTEGER,
    mes                     INTEGER,
    subcategoria            VARCHAR(30),
    obligacion              VARCHAR(30),
    tipo_transaccion        VARCHAR(30),
    descripcion             VARCHAR(100),
    monto                   DOUBLE,
    fecha                   DATE,
    metodo_pago             VARCHAR(30),
    num_factura             INTEGER,
    observaciones           VARCHAR(100),
    fecha_hora_registro     TIMESTAMP       DEFAULT CURRENT TIMESTAMP,
    creado_por              VARCHAR(300),
    creado_en               TIMESTAMP       DEFAULT CURRENT TIMESTAMP,
    modificado_por          VARCHAR(300),
    modificado_en           TIMESTAMP,
    PRIMARY KEY (id_transaccion),
    FOREIGN KEY (id_presupuesto_detalle) REFERENCES presupuesto_detalle (id_presupuesto_detalle)
);


CREATE TABLE obligacion_transaccion (
    id_transaccion  VARCHAR(30)     NOT NULL,
    id_obligacion   VARCHAR(30)     NOT NULL,
    PRIMARY KEY (id_transaccion, id_obligacion),
    FOREIGN KEY (id_obligacion)  REFERENCES obligacion_fija (id_obligacion),
    FOREIGN KEY (id_transaccion) REFERENCES transaccion (id_transaccion)
);

